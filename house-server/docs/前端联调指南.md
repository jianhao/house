# å‰ç«¯å°ç¨‹åºè”è°ƒæŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. æœåŠ¡å™¨ä¿¡æ¯
- **APIåœ°å€**: `http://localhost:3000`
- **åœ¨çº¿æ–‡æ¡£**: `http://localhost:3000/docs`
- **æ•°æ®åº“ç®¡ç†**: `http://localhost:8080` (Adminer)

### 2. å¯åŠ¨æœåŠ¡
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
docker-compose up -d  # å¯åŠ¨æ•°æ®åº“
npm run dev          # å¯åŠ¨APIæœåŠ¡
```

## æ ¸å¿ƒæ¥å£ä½¿ç”¨

### ğŸ” ç”¨æˆ·ç™»å½•
```javascript
// å¾®ä¿¡ç™»å½•
wx.login({
  success: (res) => {
    wx.request({
      url: 'http://localhost:3000/auth/wechat/login',
      method: 'POST',
      data: {
        code: res.code,
        nickname: 'ç”¨æˆ·æ˜µç§°',
        avatar: 'å¤´åƒURL'
      },
      success: (loginRes) => {
        // ä¿å­˜token
        wx.setStorageSync('token', loginRes.data.data.token)
        wx.setStorageSync('userInfo', loginRes.data.data.user)
      }
    })
  }
})
```

### ğŸ  è·å–æˆ¿æºåˆ—è¡¨
```javascript
// è·å–æˆ¿æºåˆ—è¡¨
wx.request({
  url: 'http://localhost:3000/houses',
  method: 'GET',
  data: {
    page: 1,
    pageSize: 10,
    area: 'è¥¿æ¹–åŒº',  // å¯é€‰ç­›é€‰æ¡ä»¶
    priceMin: 200,   // å¯é€‰
    priceMax: 400    // å¯é€‰
  },
  success: (res) => {
    console.log('æˆ¿æºåˆ—è¡¨:', res.data.data.list)
    console.log('åˆ†é¡µä¿¡æ¯:', res.data.data.pagination)
  }
})
```

### ğŸ¡ è·å–æˆ¿æºè¯¦æƒ…
```javascript
// è·å–æˆ¿æºè¯¦æƒ…
const houseId = '660e8400-e29b-41d4-a716-446655440001'
wx.request({
  url: `http://localhost:3000/houses/${houseId}`,
  method: 'GET',
  success: (res) => {
    console.log('æˆ¿æºè¯¦æƒ…:', res.data.data)
  }
})
```

### â¤ï¸ æ”¶è—åŠŸèƒ½
```javascript
// æ·»åŠ æ”¶è— (éœ€è¦ç™»å½•)
const token = wx.getStorageSync('token')
wx.request({
  url: `http://localhost:3000/user/collections/${houseId}`,
  method: 'POST',
  header: {
    'Authorization': `Bearer ${token}`
  },
  success: (res) => {
    wx.showToast({ title: 'æ”¶è—æˆåŠŸ' })
  }
})

// å–æ¶ˆæ”¶è—
wx.request({
  url: `http://localhost:3000/user/collections/${houseId}`,
  method: 'DELETE',
  header: {
    'Authorization': `Bearer ${token}`
  },
  success: (res) => {
    wx.showToast({ title: 'å–æ¶ˆæ”¶è—æˆåŠŸ' })
  }
})

// æ£€æŸ¥æ”¶è—çŠ¶æ€
wx.request({
  url: `http://localhost:3000/user/collections/${houseId}/status`,
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}`
  },
  success: (res) => {
    const isCollected = res.data.data.isCollected
    console.log('æ˜¯å¦å·²æ”¶è—:', isCollected)
  }
})
```

### ğŸ“‹ è·å–æ”¶è—åˆ—è¡¨
```javascript
// è·å–ç”¨æˆ·æ”¶è—åˆ—è¡¨
wx.request({
  url: 'http://localhost:3000/user/collections',
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}`
  },
  data: {
    page: 1,
    pageSize: 10
  },
  success: (res) => {
    console.log('æ”¶è—åˆ—è¡¨:', res.data.data.list)
  }
})
```

### ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯
```javascript
// è·å–ç”¨æˆ·ä¿¡æ¯
wx.request({
  url: 'http://localhost:3000/user/profile',
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}`
  },
  success: (res) => {
    console.log('ç”¨æˆ·ä¿¡æ¯:', res.data.data)
  }
})

// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
wx.request({
  url: 'http://localhost:3000/user/profile',
  method: 'PUT',
  header: {
    'Authorization': `Bearer ${token}`
  },
  data: {
    nickname: 'æ–°æ˜µç§°',
    phone: '13800138001',
    realName: 'çœŸå®å§“å'
  },
  success: (res) => {
    wx.showToast({ title: 'æ›´æ–°æˆåŠŸ' })
  }
})
```

## æµ‹è¯•æ•°æ®

### æµ‹è¯•ç”¨æˆ·ä¿¡æ¯
å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•ç”¨æˆ·è¿›è¡Œç™»å½•æµ‹è¯•ï¼š

| æ˜µç§° | OpenID | æ‰‹æœºå· | çœŸå®å§“å |
|------|--------|--------|----------|
| å¼ å°æ˜ | wx_openid_001 | 13800138001 | å¼ æ˜ |
| æå°çº¢ | wx_openid_002 | 13800138002 | æçº¢ |
| ç‹å¤§å | wx_openid_003 | 13800138003 | ç‹å |
| é™ˆå°ç¾ | wx_openid_004 | 13800138004 | é™ˆç¾ |
| åˆ˜å°å¼º | wx_openid_005 | 13800138005 | åˆ˜å¼º |

### æµ‹è¯•æˆ¿æº
ç³»ç»Ÿé¢„ç½®äº†6ä¸ªæµ‹è¯•æˆ¿æºï¼š

1. **è¥¿æ¹–å°è±¡èŠ±å›­** (ID: 660e8400-e29b-41d4-a716-446655440001)
   - åŒºåŸŸ: è¥¿æ¹–åŒº
   - ä»·æ ¼: 280ä¸‡
   - ç‰¹è‰²: å­¦åŒºæˆ¿ã€åœ°é“æ²Ÿé€š

2. **é’±æ±Ÿæ–°åŸå…¬å¯“** (ID: 660e8400-e29b-41d4-a716-446655440002)
   - åŒºåŸŸ: ä¸ŠåŸåŒº
   - ä»·æ ¼: 350ä¸‡
   - ç‰¹è‰²: æ±Ÿæ™¯æˆ¿ã€CBDæ ¸å¿ƒ

3. **æ»¨æ±Ÿç§‘æŠ€åŸ** (ID: 660e8400-e29b-41d4-a716-446655440003)
   - åŒºåŸŸ: æ»¨æ±ŸåŒº
   - ä»·æ ¼: 420ä¸‡
   - ç‰¹è‰²: ç§‘æŠ€å›­åŒºã€é…å¥—é½å…¨

## é€šç”¨å·¥å…·å‡½æ•°

### è¯·æ±‚å°è£…
```javascript
// utils/request.js
const baseURL = 'http://localhost:3000'

function request(options) {
  const token = wx.getStorageSync('token')
  
  return new Promise((resolve, reject) => {
    wx.request({
      url: baseURL + options.url,
      method: options.method || 'GET',
      data: options.data || {},
      header: {
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : '',
        ...options.header
      },
      success: (res) => {
        if (res.data.code === 200) {
          resolve(res.data)
        } else {
          wx.showToast({
            title: res.data.message || 'è¯·æ±‚å¤±è´¥',
            icon: 'none'
          })
          reject(res.data)
        }
      },
      fail: (err) => {
        wx.showToast({
          title: 'ç½‘ç»œé”™è¯¯',
          icon: 'none'
        })
        reject(err)
      }
    })
  })
}

module.exports = { request }
```

### APIå°è£…ç¤ºä¾‹
```javascript
// api/house.js
const { request } = require('../utils/request')

// è·å–æˆ¿æºåˆ—è¡¨
function getHouseList(params) {
  return request({
    url: '/houses',
    data: params
  })
}

// è·å–æˆ¿æºè¯¦æƒ…
function getHouseDetail(id) {
  return request({
    url: `/houses/${id}`
  })
}

// æ”¶è—æˆ¿æº
function collectHouse(houseId) {
  return request({
    url: `/user/collections/${houseId}`,
    method: 'POST'
  })
}

// å–æ¶ˆæ”¶è—
function uncollectHouse(houseId) {
  return request({
    url: `/user/collections/${houseId}`,
    method: 'DELETE'
  })
}

module.exports = {
  getHouseList,
  getHouseDetail,
  collectHouse,
  uncollectHouse
}
```

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†Tokenè¿‡æœŸï¼Ÿ
```javascript
// åœ¨è¯·æ±‚å¤±è´¥æ—¶æ£€æŸ¥æ˜¯å¦ä¸º401é”™è¯¯
if (res.statusCode === 401) {
  // Tokenè¿‡æœŸï¼Œé‡æ–°ç™»å½•
  wx.removeStorageSync('token')
  wx.navigateTo({
    url: '/pages/login/login'
  })
}
```

### Q2: å¦‚ä½•å¤„ç†å›¾ç‰‡æ˜¾ç¤ºï¼Ÿ
```javascript
// å°ç¨‹åºä¸­æ˜¾ç¤ºå›¾ç‰‡
<image src="{{house.coverImage}}" mode="aspectFill" />

// å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå¯ä»¥è®¾ç½®é»˜è®¤å›¾ç‰‡
<image 
  src="{{house.coverImage || '/images/default-house.png'}}" 
  mode="aspectFill"
  binderror="onImageError"
/>
```

### Q3: å¦‚ä½•å®ç°ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½ï¼Ÿ
```javascript
// é¡µé¢é…ç½®
{
  "enablePullDownRefresh": true,
  "onReachBottomDistance": 50
}

// é¡µé¢é€»è¾‘
Page({
  data: {
    houseList: [],
    page: 1,
    hasMore: true
  },
  
  // ä¸‹æ‹‰åˆ·æ–°
  onPullDownRefresh() {
    this.setData({
      page: 1,
      houseList: []
    })
    this.loadHouseList()
  },
  
  // ä¸Šæ‹‰åŠ è½½
  onReachBottom() {
    if (this.data.hasMore) {
      this.loadHouseList()
    }
  },
  
  // åŠ è½½æˆ¿æºåˆ—è¡¨
  async loadHouseList() {
    try {
      const res = await getHouseList({
        page: this.data.page,
        pageSize: 10
      })
      
      const newList = this.data.page === 1 ? 
        res.data.list : 
        [...this.data.houseList, ...res.data.list]
      
      this.setData({
        houseList: newList,
        page: this.data.page + 1,
        hasMore: res.data.pagination.page < res.data.pagination.totalPages
      })
      
      wx.stopPullDownRefresh()
    } catch (error) {
      console.error('åŠ è½½å¤±è´¥:', error)
    }
  }
})
```

## è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ç½‘ç»œé¢æ¿
- æ‰“å¼€è°ƒè¯•å™¨ â†’ Network é¢æ¿
- æŸ¥çœ‹è¯·æ±‚å’Œå“åº”è¯¦æƒ…
- æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦æ­£ç¡®

### 2. æœåŠ¡å™¨æ—¥å¿—
```bash
# æŸ¥çœ‹æœåŠ¡å™¨å®æ—¶æ—¥å¿—
npm run dev
```

### 3. æ•°æ®åº“æŸ¥çœ‹
- è®¿é—® http://localhost:8080
- ç™»å½•ä¿¡æ¯ï¼šæœåŠ¡å™¨=house-postgresï¼Œç”¨æˆ·å=postgresï¼Œå¯†ç =postgres123
- å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œä¿®æ”¹æ•°æ®

## è”ç³»æ”¯æŒ

å¦‚æœåœ¨è”è°ƒè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹APIæ–‡æ¡£ï¼šhttp://localhost:3000/docs
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. ä½¿ç”¨Postmanç­‰å·¥å…·æµ‹è¯•æ¥å£
4. è”ç³»åç«¯å¼€å‘å›¢é˜Ÿ

ç¥è”è°ƒé¡ºåˆ©ï¼ğŸ‰